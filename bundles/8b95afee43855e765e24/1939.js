"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[1939],{"../matrix-react-sdk/src/async-components/views/dialogs/eventindex/ManageEventIndexDialog.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>_});var n=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("./node_modules/react/index.js"),r=s("../matrix-react-sdk/src/languageHandler.tsx"),o=s("../matrix-react-sdk/src/SdkConfig.ts"),i=s("../matrix-react-sdk/src/settings/SettingsStore.ts"),c=s("../matrix-react-sdk/src/Modal.tsx"),l=s("../matrix-react-sdk/src/utils/FormattingUtils.ts"),m=s("../matrix-react-sdk/src/indexing/EventIndexPeg.ts"),u=s("../matrix-react-sdk/src/settings/SettingLevel.ts"),d=s("../matrix-react-sdk/src/components/views/elements/Field.tsx"),g=s("../matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),h=s("../matrix-react-sdk/src/components/views/elements/DialogButtons.tsx");class _ extends a.Component{constructor(e){super(e),(0,n.Z)(this,"updateCurrentRoom",(async e=>{var t,s,n,a;const r=m.Z.get();if(!r)return;let o;try{o=await r.getStats()}catch{return}let i=null;e&&(i=e.name);const c=r.crawlingRooms(),l=c.crawlingRooms.size,u=c.totalRooms.size;this.setState({eventIndexSize:null!==(t=null===(s=o)||void 0===s?void 0:s.size)&&void 0!==t?t:0,eventCount:null!==(n=null===(a=o)||void 0===a?void 0:a.eventCount)&&void 0!==n?n:0,crawlingRoomsCount:l,roomCount:u,currentRoom:i})})),(0,n.Z)(this,"onDisable",(async()=>{const e=(await s.e(5302).then(s.bind(s,"../matrix-react-sdk/src/async-components/views/dialogs/eventindex/DisableEventIndexDialog.tsx"))).default;c.ZP.createDialog(e,void 0,void 0,!1,!0)})),(0,n.Z)(this,"onCrawlerSleepTimeChange",(e=>{this.setState({crawlerSleepTime:parseInt(e.target.value,10)}),i.C.setValue("crawlerSleepTime",null,u.R.DEVICE,e.target.value)})),this.state={eventIndexSize:0,eventCount:0,crawlingRoomsCount:0,roomCount:0,currentRoom:null,crawlerSleepTime:i.C.getValueAt(u.R.DEVICE,"crawlerSleepTime")}}componentWillUnmount(){const e=m.Z.get();null!==e&&e.removeListener("changedCheckpoint",this.updateCurrentRoom)}async componentDidMount(){let e=0,t=0,s=0,n=0,a=null;const r=m.Z.get();if(null!==r){r.on("changedCheckpoint",this.updateCurrentRoom);try{const t=await r.getStats();t&&(e=t.size,n=t.eventCount)}catch{}const o=r.crawlingRooms();t=o.crawlingRooms.size,s=o.totalRooms.size;const i=r.currentRoom();i&&(a=i.name)}this.setState({eventIndexSize:e,eventCount:n,crawlingRoomsCount:t,roomCount:s,currentRoom:a})}render(){const e=o.ZP.get().brand;let t;t=null===this.state.currentRoom?(0,r._t)("settings|security|message_search_indexing_idle"):(0,r._t)("settings|security|message_search_indexing",{currentRoom:this.state.currentRoom});const s=Math.max(0,this.state.roomCount-this.state.crawlingRoomsCount),n=a.createElement("div",null,(0,r._t)("settings|security|message_search_intro",{brand:e}),a.createElement("div",{className:"mx_SettingsTab_subsectionText"},t,a.createElement("br",null),(0,r._t)("settings|security|message_search_space_used")," ",(0,l.td)(this.state.eventIndexSize,0),a.createElement("br",null),(0,r._t)("settings|security|message_search_indexed_messages")," ",(0,l.O1)(this.state.eventCount),a.createElement("br",null),(0,r._t)("settings|security|message_search_indexed_rooms")," ",(0,r._t)("settings|security|message_search_room_progress",{doneRooms:(0,l.O1)(s),totalRooms:(0,l.O1)(this.state.roomCount)})," ",a.createElement("br",null),a.createElement(d.Z,{label:(0,r._t)("settings|security|message_search_sleep_time"),type:"number",value:this.state.crawlerSleepTime.toString(),onChange:this.onCrawlerSleepTimeChange})));return a.createElement(g.Z,{className:"mx_ManageEventIndexDialog",onFinished:this.props.onFinished,title:(0,r._t)("settings|security|message_search_section")},n,a.createElement(h.Z,{primaryButton:(0,r._t)("action|done"),onPrimaryButtonClick:this.props.onFinished,primaryButtonClass:"primary",cancelButton:(0,r._t)("action|disable"),onCancel:this.onDisable,cancelButtonClass:"danger"}))}}}}]);
//# sourceMappingURL=1939.js.map